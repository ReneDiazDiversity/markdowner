define(["backbone","underscore","jquery","js/views/structureItem","vent"],function(e,t,n,r,i){var s=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].item.get("_id")===t)return e[n].children;return null};return e.View.extend({el:"#filelist",initialize:function(){this.collection.on("tree:sync",this.render,this),this.$elul=this.$el.children("ul"),n("html").off("click.toolbar").on("click.toolbar",function(e){n(".tool-container").hide()}),i.on("sidebar:loadDocument",this.loadDocument,this),i.on("sidebar:newfile",this.newfile,this),i.on("sidebar:newfolder",this.newfolder,this),i.on("sidebar:deletefolder",this.deleteFolder,this),i.on("sidebar:renderChildren",this.renderChildrenOfModelInView,this),i.on("sidebar:hide",this.hide,this),i.on("sidebar:show",this.show,this),i.on("sidebar:toggle",this.toggle,this)},render:function(){return this.$elul.empty(),t.each(this.collection.tree,this.renderOne,this),this},loadDocument:function(e){var t=this.collection.get(e._id);i.trigger("editor:loadDocument",t)},hide:function(){this.$el.hide()},show:function(){this.$el.show()},toggle:function(e){if(typeof e=="undefined"){this.$el.toggle(),i.trigger("user:setSidebarVisibility",this.$el.is(":visible")),this.$el.is(":visible")?n(".tool-wrapper").css({left:this.$el.outerWidth()}):n(".tool-wrapper").css({left:0});return}if(e){this.$el.show(),n(".tool-wrapper").css({left:this.$el.outerWidth()});return}this.$el.hide(),n(".tool-wrapper").css({left:0})},newfile:function(e){var t=e&&(t=e.get("_id"))||null,n=prompt("Enter filename for new file","Markdown File #1");if(n===null)return;var r={name:n,parentId:t,type:1};this.collection.create(r,{success:function(e,t,n){i.trigger("editor:loadDocument",e)}})},newfolder:function(){var e=prompt("Enter filename for new folder","Folder #1");if(e===null)return;var t={name:e,parentId:null,type:0,expanded:!1};this.collection.create(t)},deleteFolder:function(e){var n=e.get("_id"),r=s(this.collection.tree,n);t.each(r,function(e){e.item.destroy()})},renderChildrenOfModelInView:function(e,r){var i=e.model.get("_id"),r=r||s(this.collection.tree,i),o=e.$el;if(r&&r.length>0){var u=n("<ul/>").addClass("nav nav-list").hide();e.model.get("expanded")&&u.show(),o.append(u),t.each(r,function(e){e.parent=u,this.renderChild(e)},this)}},renderOne:function(e){var t=new r({model:e.item}),n=t.render();this.$elul.append(n.el)},renderChild:function(e){var t=new r({model:e.item});e.parent.append(t.render().el)}})});