define(function(e,t,n){(function(e,n,r){typeof t!="undefined"?r(t):typeof define=="function"&&define.amd?define(["exports"],r):r(e[n]={})})(this,"luaparse",function(e){function g(e){var t=v.call(arguments,1);return e=e.replace(/%(\d)/g,function(e,n){return e="",""+t[n-1]||""}),e}function y(){var e=v.call(arguments),t={},n,r;for(var i=0,s=e.length;i<s;i++){n=e[i];for(r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t}function b(e){var t=g.apply(null,v.call(arguments,1)),n,r;throw"undefined"!=typeof e.line?(r=e.range[0]-e.lineStart,n=new SyntaxError(g("[%1:%2] %3",e.line,r,t)),n.line=e.line,n.index=e.range[0],n.column=r):(r=S-L+1,n=new SyntaxError(g("[%1:%2] %3",k,r,t)),n.index=S,n.line=k,n.column=r),n}function w(e,t){b(t,p.expectedToken,e,t.value)}function E(e,t){"undefined"==typeof t&&(t=T.value);if("undefined"!=typeof e.type){var n;switch(e.type){case o:n="string";break;case u:n="keyword";break;case a:n="identifier";break;case f:n="number";break;case l:n="symbol";break;case c:n="boolean";break;case h:return b(e,p.unexpected,"symbol","nil",t)}return b(e,p.unexpected,n,e.value,t)}return b(e,p.unexpected,"symbol",e,t)}function A(){O();while(45===t.charCodeAt(S)&&45===t.charCodeAt(S+1))I(),O();if(S>=r)return{type:s,value:"<eof>",line:k,lineStart:L,range:[S,S]};var e=t.charCodeAt(S),n=t.charCodeAt(S+1);C=S;if(K(e))return M();switch(e){case 39:case 34:return D();case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return H();case 46:if($(n))return H();if(46===n)return 46===t.charCodeAt(S+2)?_("..."):_("..");return _(".");case 61:if(61===n)return _("==");return _("=");case 62:if(61===n)return _(">=");return _(">");case 60:if(61===n)return _("<=");return _("<");case 126:if(61===n)return _("~=");return b({},p.expected,"=","~");case 58:if(58===n)return _("::");return _(":");case 91:if(91===n||61===n)return P();return _("[");case 42:case 47:case 94:case 37:case 44:case 123:case 125:case 93:case 40:case 41:case 59:case 35:case 45:case 43:return _(t.charAt(S))}return E(t.charAt(S))}function O(){while(S<r){var e=t.charCodeAt(S);if(X(e))S++;else{if(!V(e))break;k++,L=++S}}}function M(){var e,n;while(Q(t.charCodeAt(++S)));return e=t.slice(C,S),G(e)?n=u:"true"===e||"false"===e?(n=c,e="true"===e):"nil"===e?(n=h,e=null):n=a,{type:n,value:e,line:k,lineStart:L,range:[C,S]}}function _(e){return S+=e.length,{type:l,value:e,line:k,lineStart:L,range:[C,S]}}function D(){var e=t.charCodeAt(S++),n=S,i="",s;while(S<r){s=t.charCodeAt(S++);if(e===s)break;if(92===s)i+=t.slice(n,S-1)+F(),n=S;else if(S>=r||V(s))i+=t.slice(n,S-1),b({},p.unfinishedString,i+String.fromCharCode(s))}return i+=t.slice(n,S-1),{type:o,value:i,line:k,lineStart:L,range:[C,S]}}function P(){var e=q();return!1===e&&b(x,p.expected,"[",x.value),{type:o,value:e,line:k,lineStart:L,range:[C,S]}}function H(){var e=t.charAt(S),n=t.charAt(S+1),r="0"===e&&~"xX".indexOf(n||null)?B():j();return{type:f,value:r,line:k,lineStart:L,range:[C,S]}}function B(){var e=0,n=1,r=1,i,s,o,u;u=S+=2,J(t.charCodeAt(S))||b({},p.malformedNumber,t.slice(C,S));while(J(t.charCodeAt(S)))S++;i=parseInt(t.slice(u,S),16);if("."===t.charAt(S)){s=++S;while(J(t.charCodeAt(S)))S++;e=t.slice(s,S),e=s===S?0:parseInt(e,16)/Math.pow(16,S-s)}if(~"pP".indexOf(t.charAt(S)||null)){S++,~"+-".indexOf(t.charAt(S)||null)&&(r="+"===t.charAt(S++)?1:-1),o=S,$(t.charCodeAt(S))||b({},p.malformedNumber,t.slice(C,S));while($(t.charCodeAt(S)))S++;n=t.slice(o,S),n=Math.pow(2,n*r)}return(i+e)*n}function j(){while($(t.charCodeAt(S)))S++;if("."===t.charAt(S)){S++;while($(t.charCodeAt(S)))S++}if(~"eE".indexOf(t.charAt(S)||null)){S++,~"+-".indexOf(t.charAt(S)||null)&&S++,$(t.charCodeAt(S))||b({},p.malformedNumber,t.slice(C,S));while($(t.charCodeAt(S)))S++}return parseFloat(t.slice(C,S))}function F(){var e=S;switch(t.charAt(S)){case"n":return S++,"\n";case"r":return S++,"\r";case"t":return S++,"	";case"v":return S++,"";case"b":return S++,"\b";case"f":return S++,"\f";case"z":return S++,O(),"";case"x":if(J(t.charCodeAt(S+1))&&J(t.charCodeAt(S+2)))return S+=3,"\\"+t.slice(e,S);return"\\"+t.charAt(S++);default:if($(t.charCodeAt(S))){while($(t.charCodeAt(++S)));return"\\"+t.slice(e,S)}return t.charAt(S++)}}function I(){C=S,S+=2;var e=t.charAt(S),i="",s=!1,o=S;"["===e&&(i=q(),!1===i?i=e:(s=!0,S+=2));if(!s){while(S<r){if(V(t.charCodeAt(S)))break;S++}i=t.slice(o,S)}n.comments&&N.push({type:"Comment",value:i,raw:t.slice(C,S)})}function q(){var e=0,n="",i=!1,s,o;S++;while("="===t.charAt(S+e))e++;if("["!==t.charAt(S+e))return!1;S+=e+1,V(t.charCodeAt(S))&&(k++,L=S++),o=S;while(S<r){s=t.charAt(S++),V(s.charCodeAt(0))&&(k++,L=S);if("]"===s){i=!0;for(var u=0;u<e;u++)"="!==t.charAt(S+u)&&(i=!1);"]"!==t.charAt(S+e)&&(i=!1)}if(i)break;"\\"===s&&(n+=t.slice(o,S-1)+F(),o=S)}return n+=t.slice(o,S-1),S+=e+1,n}function R(){x=T,T=A()}function U(e){return e===x.value?(R(),!0):!1}function z(e){if(null!=e)return e;w("<expression>",x)}function W(e){e===x.value?R():b(x,p.expected,e,x.value)}function X(e){return 9===e||32===e||11===e||12===e}function V(e){return 10===e||13===e}function $(e){return e>=48&&e<=57}function J(e){return e>=48&&e<=57||e>=97&&e<=102||e>=65&&e<=70}function K(e){return e>=65&&e<=90||e>=97&&e<=122||95===e}function Q(e){return e>=65&&e<=90||e>=97&&e<=122||95===e||e>=48&&e<=57}function G(e){switch(e.length){case 2:return"do"===e||"if"===e||"in"===e||"or"===e;case 3:return"and"===e||"end"===e||"for"===e||"not"===e;case 4:return"else"===e||"goto"===e||"then"===e;case 5:return"break"===e||"local"===e||"until"===e||"while"===e;case 6:return"elseif"===e||"repeat"===e||"return"===e;case 8:return"function"===e}return!1}function Y(e){return l===e.type?~"#-".indexOf(e.value):u===e.type?"not"===e.value:!1}function Z(e){switch(e.type){case"CallExpression":case"TableCallExpression":case"StringCallExpression":return!0}return!1}function et(e){if(s===e.type)return!0;if(u!==e.type)return!1;switch(e.value){case"else":case"elseif":case"end":case"until":return!0;default:return!1}}function tt(){R();var e=nt();return s!==x.type&&E(x),d.chunk(e)}function nt(e){var t=[],n;while(!et(x)){if("return"===x.value){t.push(rt());break}n=rt(),n&&t.push(n)}return t}function rt(){if(u===x.type)switch(x.value){case"local":return R(),pt();case"if":return R(),ct();case"return":return R(),lt();case"function":R();var e=gt();return mt(e);case"while":return R(),at();case"for":return R(),ht();case"repeat":return R(),ft();case"break":return R(),st();case"do":return R(),ut();case"goto":return R(),ot()}if(l===x.type&&U("::"))return it();if(U(";"))return;return dt()}function it(){var e=vt();return W("::"),d.labelStatement(e)}function st(){return d.breakStatement()}function ot(){var e=vt();return d.gotoStatement(e)}function ut(){var e=nt();return W("end"),d.doStatement(e)}function at(){var e=bt();W("do");var t=nt();return W("end"),d.whileStatement(e,t)}function ft(){var e=nt();W("until");var t=z(bt());return d.repeatStatement(t,e)}function lt(){var e=[];if("end"!==x.value){var t=bt();null!=t&&e.push(t);while(U(","))t=z(bt()),e.push(t);U(";")}return d.returnStatement(e)}function ct(){var e=[],t,n;do t=bt(),W("then"),n=nt(),e.push(d.elseifClause(t,n));while(U("elseif"));return U("else")&&(n=nt(),e.push(d.elseClause(n))),W("end"),d.ifStatement(e)}function ht(){var e=vt(),t;if(U("=")){var n=z(bt());W(",");var r=z(bt()),i=U(",")?z(bt()):null;return W("do"),t=nt(),W("end"),d.forNumericStatement(e,n,r,i,t)}var s=[e];while(U(","))s.push(vt());W("in");var o=[];do{var u=z(bt());o.push(u)}while(U(","));return W("do"),t=nt(),W("end"),d.forGenericStatement(s,o,t)}function pt(){if(a===x.type){var e=[],t=[];do e.push(vt());while(U(","));if(U("="))do{var n=z(bt());t.push(n)}while(U(","));return d.localStatement(e,t)}if(U("function")){var r=vt();return mt(r,!0)}w("<name>",x)}function dt(){var e=x,t=St();if(null==t)return E(x);if(~",=".indexOf(x.value)){var n=[t],r=[],i;while(U(","))i=z(St()),n.push(i);W("=");do i=z(bt()),r.push(i);while(U(","));return d.assignmentStatement(n,r)}return Z(t)?d.callStatement(t):E(e)}function vt(){var e=x.value;return a!==x.type&&w("<name>",x),R(),d.identifier(e)}function mt(e,t){var n=!1,r=[];W("(");if(U("..."))n=!0;else if(a===x.type)do{if(U("...")){n=!0;break}r.push(vt())}while(U(","));n?W(")"):U(")")||w("<name> or '...'",x);var i=nt();return W("end"),t=t||!1,d.functionStatement(e,r,n,t,i)}function gt(){var e=vt();while(U("."))e=d.memberExpression(e,".",vt());return U(":")&&(e=d.memberExpression(e,":",vt())),e}function yt(){var e=[],t,n;for(;;){if(l===x.type&&U("["))t=bt(),W("]"),W("="),n=z(bt()),e.push(d.tableKey(t,n));else if(a===x.type)t=bt(),U("=")?(n=bt(),e.push(d.tableKeyString(t,n))):e.push(d.tableValue(t));else{if(null==(n=bt()))break;e.push(d.tableValue(n))}if(~",;".indexOf(x.value)){R();continue}if("}"===x.value)break}return W("}"),d.tableConstructorExpression(e)}function bt(){var e=Et(0);return e}function wt(e){var t=e.charCodeAt(0),n=e.length;if(1===n)switch(t){case 94:return 10;case 42:case 47:case 37:return 7;case 43:case 45:return 6;case 60:case 62:return 3}else if(2===n)switch(t){case 46:return 5;case 60:case 62:case 61:case 126:return 3;case 111:return 1}else if(97===t&&"and"===e)return 2;return 0}function Et(e){var t=x.value,n;if(Y(x)){R();var r=z(Et(8));n=d.unaryExpression(t,r)}null==n&&(n=Tt(),null==n&&(n=St()));if(null==n)return null;var i;for(;;){t=x.value,i=l===x.type||u===x.type?wt(t):0;if(i===0||i<=e)break;("^"===t||".."===t)&&i--,R();var s=z(Et(i));n=d.binaryExpression(t,n,s)}return n}function St(){var e;if(a===x.type)e=vt();else{if(!U("("))return null;e=bt(),W(")")}var t,n;for(;;){z(e);if(l===x.type)switch(x.value){case"[":R(),t=bt(),e=d.indexExpression(e,t),W("]");break;case".":R(),n=vt(),e=d.memberExpression(e,".",n);break;case":":R(),n=vt(),e=d.memberExpression(e,":",n),e=xt(e);break;case"(":case"{":e=xt(e);break;default:return e}else{if(o!==x.type)break;e=xt(e)}}return e}function xt(e){if(l===x.type)switch(x.value){case"(":R();var t=[],n=bt();null!=n&&t.push(n);while(U(","))n=z(bt()),t.push(n);return W(")"),d.callExpression(e,t);case"{":R();var r=yt();return d.tableCallExpression(e,r)}else if(o===x.type){var i=x.value;return R(),d.stringCallExpression(e,i)}w("function arguments",x)}function Tt(){var e=o|f|c|h,n=x.value;if(x.type&e){var r=t.slice(x.range[0],x.range[1]);return R(),d.literal(n,r)}if(u===x.type&&"function"===x.value)return R(),mt(null);if(l===x.type){if(U("..."))return d.varargLiteral(n);if(U("{"))return yt()}}function Nt(s,o){return"undefined"==typeof o&&"object"==typeof s&&(o=s,s=undefined),o||(o={}),t=s||"",n=y(i,o),S=0,k=1,L=0,r=t.length,n.comments&&(N=[]),n.wait?e:kt()}function Ct(n){return t+=String(n),r=t.length,e}function kt(e){"undefined"!=typeof e&&Ct(e),r=t.length,T=A();var i=tt();return n.comments&&(i.comments=N),i}e.version="0.0.1";var t,n,r,i=e.defaultOptions={wait:!1,comments:!0},s=1,o=2,u=4,a=8,f=16,l=32,c=64,h=128,p=e.errors={unexpected:"Unexpected %1 '%2' near '%3'",expected:"'%1' expected near '%2'",expectedToken:"%1 expected near '%2'",unfinishedString:"unfinished string near '%1'",malformedNumber:"malformed number near '%1'"},d=e.ast={labelStatement:function(e){return{type:"LabelStatement",label:e}},breakStatement:function(){return{type:"BreakStatement"}},gotoStatement:function(e){return{type:"GotoStatement",label:e}},returnStatement:function(e){return{type:"ReturnStatement",arguments:e}},ifStatement:function(e){return{type:"IfStatement",clauses:e}},elseifClause:function(e,t){return{type:"ElseifClause",condition:e,body:t}},elseClause:function(e){return{type:"ElseClause",body:e}},whileStatement:function(e,t){return{type:"WhileStatement",condition:e,body:t}},doStatement:function(e){return{type:"DoStatement",body:e}},repeatStatement:function(e,t){return{type:"RepeatStatement",condition:e,body:t}},localStatement:function(e,t){return{type:"LocalStatement",variables:e,init:t}},assignmentStatement:function(e,t){return{type:"AssignmentStatement",variables:e,init:t}},callStatement:function(e){return{type:"CallStatement",expression:e}},functionStatement:function(e,t,n,r,i){return{type:"FunctionDeclaration",identifier:e,vararg:n,local:r,parameters:t,body:i}},forNumericStatement:function(e,t,n,r,i){return{type:"ForNumericStatement",variable:e,start:t,end:n,step:r,body:i}},forGenericStatement:function(e,t,n){return{type:"ForGenericStatement",variables:e,iterators:t,body:n}},chunk:function(e){return{type:"Chunk",body:e}},identifier:function(e){return{type:"Identifier",name:e}},literal:function(e,t){return{type:"Literal",value:e,raw:t}},varargLiteral:function(){return{type:"VarargLiteral"}},tableKey:function(e,t){return{type:"TableKey",key:e,value:t}},tableKeyString:function(e,t){return{type:"TableKeyString",key:e,value:t}},tableValue:function(e){return{type:"TableValue",value:e}},tableConstructorExpression:function(e){return{type:"TableConstructorExpression",fields:e}},binaryExpression:function(e,t,n){var r="and"===e||"or"===e?"LogicalExpression":"BinaryExpression";return{type:r,operator:e,left:t,right:n}},unaryExpression:function(e,t){return{type:"UnaryExpression",operator:e,argument:t}},memberExpression:function(e,t,n){return{type:"MemberExpression",indexer:t,identifier:n,base:e}},indexExpression:function(e,t){return{type:"IndexExpression",base:e,index:t}},callExpression:function(e,t){return{type:"CallExpression",base:e,arguments:t}},tableCallExpression:function(e,t){return{type:"TableCallExpression",base:e,arguments:t}},stringCallExpression:function(e,t){return{type:"StringCallExpression",base:e,argument:t}}},v=Array.prototype.slice,m=Object.prototype.toString,S,x,T,N,C,k,L;e.parse=Nt,e.write=Ct,e.end=kt,e.lex=A})});