/* ***** BEGIN LICENSE BLOCK *****
 * Version: MPL 1.1/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 1.1 (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * The Original Code is the Narcissus JavaScript engine.
 *
 * The Initial Developer of the Original Code is
 * Brendan Eich <brendan@mozilla.org>.
 * Portions created by the Initial Developer are Copyright (C) 2004
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 *   Tom Austin <taustin@ucsc.edu>
 *   Brendan Eich <brendan@mozilla.org>
 *   Shu-Yu Guo <shu@rfrn.org>
 *   Dave Herman <dherman@mozilla.com>
 *   Dimitris Vardoulakis <dimvar@ccs.neu.edu>
 *   Patrick Walton <pcwalton@mozilla.com>
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 2 or later (the "GPL"), or
 * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** */

define(["require","exports","module"],function(require,exports,module){function defineGetter(e,t,n,r,i){Object.defineProperty(e,t,{get:n,configurable:!r,enumerable:!i})}function defineGetterSetter(e,t,n,r,i,s){Object.defineProperty(e,t,{get:n,set:r,configurable:!i,enumerable:!s})}function defineMemoGetter(e,t,n,r,i){Object.defineProperty(e,t,{get:function(){var s=n();return defineProperty(e,t,s,r,!0,i),s},configurable:!0,enumerable:!i})}function defineProperty(e,t,n,r,i,s){Object.defineProperty(e,t,{value:n,writable:!i,configurable:!r,enumerable:!s})}function isNativeCode(e){return typeof e=="function"&&e.toString().match(/\[native code\]/)}function apply(e,t,n){return Fpapply.call(e,[t].concat(n))}function getPropertyDescriptor(e,t){while(e){if({}.hasOwnProperty.call(e,t))return Object.getOwnPropertyDescriptor(e,t);e=Object.getPrototypeOf(e)}}function getPropertyNames(e){var t=Object.create(null,{});while(e){var n=Object.getOwnPropertyNames(e);for(var r=0,i=n.length;r<i;r++)t[n[r]]=!0;e=Object.getPrototypeOf(e)}return Object.keys(t)}function getOwnProperties(e){var t={};for(var n in Object.getOwnPropertyNames(e))t[n]=Object.getOwnPropertyDescriptor(e,n);return t}function blacklistHandler(e,t){var n=Object.create(null,{}),r=Dict.create(t).mapObject(function(e){return n});return mixinHandler(r,e)}function whitelistHandler(e,t){var n=Object.create(null,{}),r=Dict.create(t).mapObject(function(t){return e});return mixinHandler(r,n)}function mixinHandler(e,t){function n(n){return hasOwn(e,n)?e[n]:t}function r(e){var t=getPropertyDescriptor(n(e),e);return t&&(t.configurable=!0),t}function i(){var n=Object.getOwnPropertyNames(e).filter(function(t){return t in e[t]}),r=getPropertyNames(t).filter(function(t){return!hasOwn(e,t)});return n.concat(r)}function s(){var n=Object.getOwnPropertyNames(e).filter(function(t){return t in e[t]});for(name in t)hasOwn(e,name)||n.push(name);return n}function o(e){return e in n(e)}return{getOwnPropertyDescriptor:r,getPropertyDescriptor:r,getOwnPropertyNames:i,defineProperty:function(e,t){Object.defineProperty(n(e),e,t)},"delete":function(e){var t=n(e);return delete t[e]},fix:function(){},has:o,hasOwn:o,get:function(e,t){var r=n(t);return r[t]},set:function(e,t,r){var i=n(t);return i[t]=r,!0},enumerate:s,keys:s}}function makePassthruHandler(e){return{getOwnPropertyDescriptor:function(t){var n=Object.getOwnPropertyDescriptor(e,t);return n.configurable=!0,n},getPropertyDescriptor:function(t){var n=getPropertyDescriptor(e,t);return n.configurable=!0,n},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(e)},defineProperty:function(t,n){Object.defineProperty(e,t,n)},"delete":function(t){return delete e[t]},fix:function(){return Object.isFrozen(e)?getOwnProperties(e):undefined},has:function(t){return t in e},hasOwn:function(t){return{}.hasOwnProperty.call(e,t)},get:function(t,n){return e[n]},set:function(t,n,r){return e[n]=r,!0},enumerate:function(){var t=[];for(name in e)t.push(name);return t},keys:function(){return Object.keys(e)}}}function hasOwn(e,t){return hasOwnProperty.call(e,t)}function Dict(e,t){this.table=e||Object.create(null,{}),this.size=t||0}function Stack(e){this.elts=e||null}var tokens=["END","\n",";",",","=","?",":","CONDITIONAL","||","&&","|","^","&","==","!=","===","!==","<","<=",">=",">","<<",">>",">>>","+","-","*","/","%","!","~","UNARY_PLUS","UNARY_MINUS","++","--",".","[","]","{","}","(",")","SCRIPT","BLOCK","LABEL","FOR_IN","CALL","NEW_WITH_ARGS","INDEX","ARRAY_INIT","OBJECT_INIT","PROPERTY_INIT","GETTER","SETTER","GROUP","LIST","LET_BLOCK","ARRAY_COMP","GENERATOR","COMP_TAIL","IMPLEMENTS","INTERFACE","LET","MODULE","PACKAGE","PRIVATE","PROTECTED","PUBLIC","STATIC","USE","YIELD","IDENTIFIER","NUMBER","STRING","REGEXP","break","case","catch","const","continue","debugger","default","delete","do","else","export","false","finally","for","function","if","import","in","instanceof","new","null","return","switch","this","throw","true","try","typeof","var","void","while","with"],strictKeywords={__proto__:null,"implements":!0,"interface":!0,let:!0,"package":!0,"private":!0,"protected":!0,"public":!0,"static":!0,use:!0,yield:!0},statementStartTokens=["break","const","continue","debugger","do","for","if","let","return","switch","throw","try","var","yield","while","with"],whitespaceChars=["	","","\f"," "," ","﻿"," ","᠎"," "," "," "," "," "," "," "," "," "," "," "," "," ","　"],whitespace={};for(var i=0;i<whitespaceChars.length;i++)whitespace[whitespaceChars[i]]=!0;var opTypeNames={"\n":"NEWLINE",";":"SEMICOLON",",":"COMMA","?":"HOOK",":":"COLON","||":"OR","&&":"AND","|":"BITWISE_OR","^":"BITWISE_XOR","&":"BITWISE_AND","===":"STRICT_EQ","==":"EQ","=":"ASSIGN","!==":"STRICT_NE","!=":"NE","<<":"LSH","<=":"LE","<":"LT",">>>":"URSH",">>":"RSH",">=":"GE",">":"GT","++":"INCREMENT","--":"DECREMENT","+":"PLUS","-":"MINUS","*":"MUL","/":"DIV","%":"MOD","!":"NOT","~":"BITWISE_NOT",".":"DOT","[":"LEFT_BRACKET","]":"RIGHT_BRACKET","{":"LEFT_CURLY","}":"RIGHT_CURLY","(":"LEFT_PAREN",")":"RIGHT_PAREN"},keywords={__proto__:null},mozillaKeywords={__proto__:null},tokenIds={},hostSupportsEvalConst=function(){try{return eval("(function(s) { eval(s); return x })('const x = true;')")}catch(e){return!1}}(),consts=hostSupportsEvalConst?"const ":"var ";for(var i=0,j=tokens.length;i<j;i++){i>0&&(consts+=", ");var t=tokens[i],name;if(/^[a-z]/.test(t)){name=t.toUpperCase();if(name==="LET"||name==="YIELD")mozillaKeywords[name]=i;strictKeywords[name]&&(strictKeywords[name]=i),keywords[t]=i}else name=/^\W/.test(t)?opTypeNames[t]:t;consts+=name+" = "+i,tokenIds[name]=i,tokens[t]=i}consts+=";";var isStatementStartCode={__proto__:null};for(i=0,j=statementStartTokens.length;i<j;i++)isStatementStartCode[keywords[statementStartTokens[i]]]=!0;var assignOps=["|","^","&","<<",">>",">>>","+","-","*","/","%"];for(i=0,j=assignOps.length;i<j;i++)t=assignOps[i],assignOps[t]=tokens[t];var Fpapply=Function.prototype.apply,applyNew;Function.prototype.bind?applyNew=function(t,n){return new(t.bind.apply(t,[,].concat(Array.prototype.slice.call(n))))}:applyNew=function applyNew(f,a){switch(a.length){case 0:return new f;case 1:return new f(a[0]);case 2:return new f(a[0],a[1]);case 3:return new f(a[0],a[1],a[2]);default:var argStr="a[0]";for(var i=1,n=a.length;i<n;i++)argStr+=",a["+i+"]";return eval("new f("+argStr+")")}};var hasOwnProperty={}.hasOwnProperty;Dict.create=function(e){var t=Object.create(null,{}),n=0,r=Object.getOwnPropertyNames(e);for(var i=0,s=r.length;i<s;i++){var o=r[i];t[o]=e[o],n++}return new Dict(t,n)},Dict.prototype={has:function(e){return hasOwnProperty.call(this.table,e)},set:function(e,t){hasOwnProperty.call(this.table,e)||this.size++,this.table[e]=t},get:function(e){return this.table[e]},getDef:function(e,t){return hasOwnProperty.call(this.table,e)||(this.size++,this.table[e]=t()),this.table[e]},forEach:function(e){var t=this.table;for(var n in t)e.call(this,n,t[n])},map:function(e){var t=this.table,n=Object.create(null,{});return this.forEach(function(t,r){n[t]=e.call(this,r,t)}),new Dict(n,this.size)},mapObject:function(e){var t=this.table,n=Object.create(null,{});return this.forEach(function(t,r){n[t]=e.call(this,r,t)}),n},toObject:function(){return this.mapObject(function(e){return e})},choose:function(){return Object.getOwnPropertyNames(this.table)[0]},remove:function(e){hasOwnProperty.call(this.table,e)&&(this.size--,delete this.table[e])},copy:function(){var e=Object.create(null,{});for(var t in this.table)e[t]=this.table[t];return new Dict(e,this.size)},keys:function(){return Object.keys(this.table)},toString:function(){return"[object Dict]"}};var _WeakMap=typeof WeakMap=="function"?WeakMap:function(){function e(e){this.array=e||[]}function t(e,t,n,r){var i=e.array;for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u.key===t)return n(u,s)}return r()}return e.prototype={has:function(e){return t(this,e,function(){return!0},function(){return!1})},set:function(e,n){var r=this.array;t(this,e,function(e){e.value=n},function(){r.push({key:e,value:n})})},get:function(e){return t(this,e,function(e){return e.value},function(){return null})},"delete":function(e){var n=this.array;t(this,e,function(e,t){n.splice(t,1)},function(){})},toString:function(){return"[object WeakMap]"}},e}();Stack.prototype={push:function(e){return new Stack({top:e,rest:this.elts})},top:function(){if(!this.elts)throw new Error("empty stack");return this.elts.top},isEmpty:function(){return this.top===null},find:function(e){for(var t=this.elts;t;t=t.rest)if(e(t.top))return t.top;return null},has:function(e){return Boolean(this.find(function(t){return t===e}))},forEach:function(e){for(var t=this.elts;t;t=t.rest)e(t.top)}},Array.prototype.copy||defineProperty(Array.prototype,"copy",function(){var e=[];for(var t=0,n=this.length;t<n;t++)e[t]=this[t];return e},!1,!1,!0),Array.prototype.top||defineProperty(Array.prototype,"top",function(){return this.length&&this[this.length-1]},!1,!1,!0),exports.tokens=tokens,exports.whitespace=whitespace,exports.opTypeNames=opTypeNames,exports.keywords=keywords,exports.mozillaKeywords=mozillaKeywords,exports.strictKeywords=strictKeywords,exports.isStatementStartCode=isStatementStartCode,exports.tokenIds=tokenIds,exports.consts=consts,exports.assignOps=assignOps,exports.defineGetter=defineGetter,exports.defineGetterSetter=defineGetterSetter,exports.defineMemoGetter=defineMemoGetter,exports.defineProperty=defineProperty,exports.isNativeCode=isNativeCode,exports.apply=apply,exports.applyNew=applyNew,exports.mixinHandler=mixinHandler,exports.whitelistHandler=whitelistHandler,exports.blacklistHandler=blacklistHandler,exports.makePassthruHandler=makePassthruHandler,exports.Dict=Dict,exports.WeakMap=_WeakMap,exports.Stack=Stack});